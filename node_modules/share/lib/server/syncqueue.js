var __slice = Array.prototype.slice;

module.exports = function(process) {
  var enqueue, flush, queue;
  if (typeof process !== 'function') throw new Error('process is not a function');
  queue = [];
  enqueue = function(data, callback) {
    queue.push([data, callback]);
    return flush();
  };
  enqueue.busy = false;
  enqueue.queue = queue;
  flush = function() {
    var callback, data, _ref;
    if (enqueue.busy || queue.length === 0) return;
    enqueue.busy = true;
    _ref = queue.shift(), data = _ref[0], callback = _ref[1];
    return process(data, function() {
      var result;
      result = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      enqueue.busy = false;
      if (callback) callback.apply(null, result);
      return flush();
    });
  };
  return enqueue;
};
